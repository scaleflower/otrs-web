<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTRS工单数据分析系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-chart-line"></i> OTRS工单数据分析系统</h1>
                <p>上传Excel文件，获取详细的工单统计分析和可视化报告</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload Section -->
            <section class="upload-section">
                <div class="upload-card">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h2>上传Excel文件</h2>
                    <p>支持 .xlsx 和 .xls 格式的文件</p>
                    
                    <form id="uploadForm" class="upload-form">
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" accept=".xlsx,.xls" class="file-input">
                            <label for="fileInput" class="file-input-label">
                                <i class="fas fa-file-excel"></i>
                                <span>选择Excel文件</span>
                            </label>
                        </div>
                        <button type="submit" class="upload-btn" disabled>
                            <i class="fas fa-upload"></i>
                            开始分析
                        </button>
                    </form>
                    
                    <div id="fileInfo" class="file-info" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                        <span id="fileName"></span>
                    </div>
                </div>
            </section>

            <!-- Loading Section -->
            <section id="loadingSection" class="loading-section" style="display: none;">
                <div class="loading-card">
                    <div class="spinner"></div>
                    <h3>正在分析数据...</h3>
                    <p>请稍候，系统正在处理您的Excel文件</p>
                </div>
            </section>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <div class="results-header">
                    <h2><i class="fas fa-chart-bar"></i> 分析结果</h2>
                    <div class="export-buttons">
                        <button id="exportExcel" class="btn btn-primary">
                            <i class="fas fa-file-excel"></i> 导出Excel
                        </button>
                        <button id="exportTxt" class="btn btn-secondary">
                            <i class="fas fa-file-alt"></i> 导出文本
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="card-icon total">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="card-content">
                            <h3 id="totalRecords">0</h3>
                            <p>总记录数</p>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="card-icon open">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="card-content">
                            <h3 id="openTickets">0</h3>
                            <p>当前开放工单</p>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="card-icon empty">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="card-content">
                            <h3 id="emptyFirstResponse">0</h3>
                            <p>空FirstResponse</p>
                        </div>
                    </div>
                </div>

                <!-- Detailed Results -->
                <div class="detailed-results">
                    <!-- Daily Statistics -->
                    <div class="result-card">
                        <h3><i class="fas fa-calendar-day"></i> 每日统计</h3>
                        <div class="table-container">
                            <table id="dailyTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th>日期</th>
                                        <th>新增工单</th>
                                        <th>关闭工单</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Priority Distribution -->
                    <div class="result-card">
                        <h3><i class="fas fa-star"></i> 优先级分布</h3>
                        <div class="chart-container">
                            <canvas id="priorityChart"></canvas>
                        </div>
                    </div>

                    <!-- State Distribution -->
                    <div class="result-card">
                        <h3><i class="fas fa-tasks"></i> 状态分布</h3>
                        <div class="chart-container">
                            <canvas id="stateChart"></canvas>
                        </div>
                    </div>

                    <!-- Empty FirstResponse -->
                    <div class="result-card">
                        <h3><i class="fas fa-exclamation-circle"></i> 空FirstResponse分布</h3>
                        <div class="chart-container">
                            <canvas id="emptyFirstResponseChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Error Section -->
            <section id="errorSection" class="error-section" style="display: none;">
                <div class="error-card">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>处理失败</h3>
                    <p id="errorMessage"></p>
                    <button onclick="hideError()" class="btn btn-primary">重试</button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 OTRS工单分析系统 | 基于Flask和Pandas构建</p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
