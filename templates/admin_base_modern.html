<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}后台管理 - OTRS工单管理系统{% endblock %}</title>

    <!-- Modern Layout CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-layout.css') }}">

    <!-- Admin-specific CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-modern.css') }}">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="top-navbar">
        <!-- Logo和品牌名 -->
        <a href="{{ url_for('index') }}" class="navbar-brand">
            <div class="navbar-brand-icon">
                <i class="fas fa-ticket-alt"></i>
            </div>
            <span>OTRS工单系统</span>
        </a>

        <!-- 主菜单 -->
        <div class="navbar-menu">
            <a href="{{ url_for('index') }}" class="navbar-menu-item">
                <i class="fas fa-home"></i> 首页
            </a>
            <a href="{{ url_for('statistics_bp.statistics_page') }}" class="navbar-menu-item">
                <i class="fas fa-chart-bar"></i> 统计分析
            </a>
            <a href="{{ url_for('responsible_stats') }}" class="navbar-menu-item">
                <i class="fas fa-users"></i> 负责人统计
            </a>
            <a href="{{ url_for('database_page') }}" class="navbar-menu-item">
                <i class="fas fa-database"></i> 数据概览
            </a>
            <a href="/admin" class="navbar-menu-item active">
                <i class="fas fa-cog"></i> 后台管理
            </a>
        </div>

        <!-- 右侧操作区 -->
        <div class="navbar-actions">
            <!-- 搜索框 -->
            <div class="navbar-search">
                <i class="fas fa-search navbar-search-icon"></i>
                <input type="text" class="navbar-search-input" placeholder="搜索...">
            </div>

            <!-- 通知图标 -->
            <button class="navbar-icon-btn" title="通知">
                <i class="fas fa-bell"></i>
                <span class="badge"></span>
            </button>

            <!-- 帮助图标 -->
            <button class="navbar-icon-btn" title="帮助">
                <i class="fas fa-question-circle"></i>
            </button>

            <!-- 用户信息 -->
            <div class="navbar-user" onclick="toggleUserMenu()">
                <div class="navbar-user-avatar">
                    {{ session.get('username', 'Admin')[0].upper() }}
                </div>
                <span>{{ session.get('username', 'Admin') }}</span>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </nav>

    <!-- 主容器 -->
    <div class="app-container">
        <!-- 管理侧边栏 -->
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="admin-sidebar-header">
                <h3 class="admin-sidebar-title">
                    <i class="fas fa-tools"></i>
                    系统管理
                </h3>
            </div>

            <div class="admin-sidebar-menu">
                <!-- 用户与权限 -->
                <div class="admin-menu-group">
                    <div class="admin-menu-group-title">用户与权限</div>
                    <a href="{{ url_for('admin.user_management') }}" class="admin-menu-item {% if request.endpoint == 'admin.user_management' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-users"></i>
                        </span>
                        <span class="admin-menu-item-text">用户管理</span>
                    </a>
                    <a href="{{ url_for('admin.permission_management') }}" class="admin-menu-item {% if request.endpoint == 'admin.permission_management' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-shield-alt"></i>
                        </span>
                        <span class="admin-menu-item-text">权限管理</span>
                    </a>
                </div>

                <!-- 系统配置 -->
                <div class="admin-menu-group">
                    <div class="admin-menu-group-title">系统配置</div>
                    <a href="{{ url_for('admin.system_config') }}" class="admin-menu-item {% if request.endpoint == 'admin.system_config' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-cog"></i>
                        </span>
                        <span class="admin-menu-item-text">系统设置</span>
                    </a>
                    <a href="{{ url_for('admin.notification_management') }}" class="admin-menu-item {% if request.endpoint == 'admin.notification_management' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-bell"></i>
                        </span>
                        <span class="admin-menu-item-text">通知管理</span>
                    </a>
                </div>

                <!-- 运维管理 -->
                <div class="admin-menu-group">
                    <div class="admin-menu-group-title">运维管理</div>
                    <a href="{{ url_for('admin.system_maintenance') }}" class="admin-menu-item {% if request.endpoint == 'admin.system_maintenance' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-wrench"></i>
                        </span>
                        <span class="admin-menu-item-text">系统维护</span>
                    </a>
                    <a href="{{ url_for('admin.log_query') }}" class="admin-menu-item {% if request.endpoint == 'admin.log_query' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-file-alt"></i>
                        </span>
                        <span class="admin-menu-item-text">日志查询</span>
                    </a>
                    <a href="{{ url_for('admin.backup_management') }}" class="admin-menu-item {% if request.endpoint == 'admin.backup_management' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-database"></i>
                        </span>
                        <span class="admin-menu-item-text">数据备份</span>
                    </a>
                    <a href="{{ url_for('admin.system_upgrade') }}" class="admin-menu-item {% if request.endpoint == 'admin.system_upgrade' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-arrow-circle-up"></i>
                        </span>
                        <span class="admin-menu-item-text">系统升级</span>
                    </a>
                </div>

                <!-- 监控统计 -->
                <div class="admin-menu-group">
                    <div class="admin-menu-group-title">监控统计</div>
                    <a href="{{ url_for('admin.system_monitor') }}" class="admin-menu-item {% if request.endpoint == 'admin.system_monitor' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-chart-line"></i>
                        </span>
                        <span class="admin-menu-item-text">系统监控</span>
                    </a>
                    <a href="{{ url_for('admin.operation_logs') }}" class="admin-menu-item {% if request.endpoint == 'admin.operation_logs' %}active{% endif %}">
                        <span class="admin-menu-item-icon">
                            <i class="fas fa-history"></i>
                        </span>
                        <span class="admin-menu-item-text">操作日志</span>
                    </a>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="admin-main-content">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // 用户菜单
        function toggleUserMenu() {
            alert('用户菜单功能待实现');
        }

        // 搜索功能
        document.querySelector('.navbar-search-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchText = this.value.trim();
                if (searchText) {
                    alert('搜索功能待实现: ' + searchText);
                }
            }
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
